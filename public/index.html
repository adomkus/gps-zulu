<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta id="meta-theme-color" name="theme-color" content="#2f5233">
    <title>GPS Pokalbiai</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/main.css?v=1">

    <!-- External Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <!-- Core modules -->
    <script src="/js/core/config.js"></script>
    <script src="/js/core/state.js"></script>
    <script src="/js/core/dom.js"></script>
    <script src="/js/core/utils.js"></script>
    <script src="/js/core/app.js"></script>
    
    <!-- API and communication -->
    <script src="/js/api/api.js"></script>
    <script src="/js/api/socket.js"></script>
    
    <!-- Authentication -->
    <script src="/js/auth/auth.js"></script>
    
    <!-- UI components -->
    <script src="/js/ui/views.js"></script>
    <script src="/js/ui/modals.js"></script>
    <script src="/js/ui/chat.js"></script>
    <script src="/js/ui/settings.js"></script>
    <script src="/js/ui/events.js"></script>
    
    <!-- Map and location -->
    <script src="/js/map/map.js"></script>
    <script src="/js/map/location.js"></script>
    
    <!-- Notifications and background -->
    <script src="/js/notifications/notifications.js"></script>
    <script src="/js/notifications/background.js"></script>
    
    <!-- Admin functionality -->
    <script src="/js/admin/admin.js"></script>
    <script src="/js/admin/following.js"></script>
</head>
<body>
    <!-- Authentication Container -->
    <div id="auth-container">
        <div class="auth-form">
            <h2 id="auth-title">Prisijungti</h2>
            <form id="login-form">
                <input type="text" id="login-username" placeholder="Vartotojo vardas" required>
                <input type="password" id="login-password" placeholder="Slapta≈æodis" required>
                <label style="display:flex;align-items:center;gap:8px;margin:6px 0 8px 0;cursor:pointer;">
                    <input type="checkbox" id="remember-me">
                    <span>Likti prisijungus?</span>
                </label>
                <button type="submit">Prisijungti</button>
                <div class="error" id="login-error"></div>
            </form>
            <div class="toggle-link" id="show-register">Neturite paskyros? Registruokitƒós</div>
        </div>
        
        <div class="auth-form hidden" id="register-form">
            <h2>Registracija</h2>
            <form id="register-form-submit">
                <input type="text" id="register-username" placeholder="Vartotojo vardas" required>
                <input type="password" id="register-password" placeholder="Slapta≈æodis" required>
                <input type="password" id="register-confirm-password" placeholder="Pakartokite slapta≈æodƒØ" required>
                <button type="submit">Registruotis</button>
                <div class="error" id="register-error"></div>
            </form>
            <div class="toggle-link" id="show-login">Jau turite paskyrƒÖ? Prisijunkite</div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="hidden">
        <!-- Top Navigation Bar -->
        <header id="top-bar">
            <div class="nav-controls">
                <button class="nav-btn active" data-view="users-view">Vartotojai</button>
                <button class="nav-btn" data-view="map-view">≈Ωemƒólapis</button>
                <button class="nav-btn" data-view="settings-view">Nustatymai</button>
            </div>
        </header>
        <div id="main-content">
            <div id="users-view" class="view active">
                <div id="secondary-bar">
                    <button class="secondary-nav-btn active" data-view="general-chat-view">Bendras ƒçatas</button>
                    <button class="secondary-nav-btn" data-view="my-chats-view">Mano pokalbiai</button>
                    <button class="secondary-nav-btn" data-view="unread-chats-view">Neperskaitytos</button>
                </div>
                <div id="users-list-container">
                    <ul id="users-list"></ul>
                    <div class="placeholder">Vartotoj≈≥ sƒÖra≈°as kraunasi...</div>
                </div>
                <div id="general-chat-view" class="sub-view active">
                    <!-- General chat content will be here, loaded by JS -->
                </div>
                <div id="my-chats-view" class="sub-view">
                    <!-- User's private chats list will be here -->
                </div>
                <div id="unread-chats-view" class="sub-view">
                    <!-- Unread chats list will be here -->
                </div>
            </div>
            <div id="map-view" class="view">
                <div id="map"></div>
            </div>
            <div id="settings-view" class="view">
                <!-- Settings content here -->
            </div>
            <div id="admin-panel" class="hidden">
                <h3>Admin Panel</h3>
                <button id="show-logs-btn" class="admin-btn">Rodyti LOG'us</button>
            </div>
        </div>
        <div id="chat-view">
            <div id="chat-header">
                <button id="chat-back-btn">‚Üê</button>
                <h2 id="chat-header-title">Pokalbis</h2>
            </div>
            <div id="messages-list"></div>
            <form id="message-form">
                <input type="text" id="message-input" placeholder="J≈´s≈≥ ≈æinutƒó..." autocomplete="off">
                <button type="submit">‚Üë</button>
            </form>
        </div>
    </div>

    <!-- System Logs Modal (Admin only) -->
    <div id="logs-modal" class="modal-backdrop">
        <div class="modal">
            <header>
                <span>üìä Sistema log'ai</span>
                <button id="logs-close">‚úï</button>
            </header>
            <div class="content">
                <div class="log-toolbar">
                    <button id="logs-clear">I≈°valyti</button>
                    <button id="logs-copy">Kopijuoti</button>
                </div>
                <pre id="logs-modal-body" class="log-area"></pre>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu-overlay" class="hidden">
        <div id="context-menu-wrapper">
            <div id="context-menu">
                <h3 id="context-menu-title"></h3>
                <div id="context-menu-actions"></div>
            </div>
            <div id="context-menu-cancel">
                <button data-action="cancel">At≈°aukti</button>
            </div>
        </div>
    </div>

    <!-- User Detail Modal -->
    <div id="user-detail-modal" class="hidden">
        <div class="user-detail-content">
            <div class="user-detail-header">
                <h3 id="user-detail-name"></h3>
                <button id="user-detail-close">‚úï</button>
            </div>
            <div class="user-detail-body">
                <div class="user-detail-item">
                    <label>Vartotojo vardas:</label>
                    <span id="user-detail-username"></span>
                </div>
                <div class="user-detail-item">
                    <label>Paskyros tipas:</label>
                    <span id="user-detail-role"></span>
                </div>
                <div class="user-detail-item">
                    <label>Paskyros data:</label>
                    <span id="user-detail-created"></span>
                </div>
                <div class="user-detail-item">
                    <label>Paskutinis prisijungimas:</label>
                    <span id="user-detail-last-seen"></span>
                </div>
                <div class="user-detail-item">
                    <label>Dabartinƒó vietovƒó:</label>
                    <span id="user-detail-location"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden">
        <div id="settings-content">
            <h2>Nustatymai</h2>
            <div class="setting-item">
                <label for="settings-sound">Garsinis prane≈°imas</label>
                <input type="checkbox" id="settings-sound">
            </div>
            <div class="setting-item">
                <label for="settings-vibrate">Vibracinis prane≈°imas</label>
                <input type="checkbox" id="settings-vibrate">
            </div>
            <div class="setting-item">
                <label for="settings-background-location">Vietovƒós sekimas fone</label>
                <input type="checkbox" id="settings-background-location">
            </div>
            <div class="setting-item">
                <label for="settings-background-notifications">Prane≈°imai fone</label>
                <input type="checkbox" id="settings-background-notifications">
            </div>
            <div class="setting-item">
                <label for="settings-theme">Tema</label>
                <select id="settings-theme">
                    <option value="light">≈†viesi</option>
                    <option value="dark">Tamsi</option>
                </select>
            </div>
            <button id="settings-close">U≈ædaryti</button>
        </div>
    </div>

    <!-- Status Indicators -->
    <div id="following-indicator">Sekama: <span id="following-username"></span></div>
    <div id="connection-status" title="Ry≈°io b≈´sena">
        <span id="connection-dot" style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#d1d5db;vertical-align:middle;margin-right:6px;"></span>
        <span id="connection-text" style="display:none">Tikrinama...</span>
    </div>

    <!-- Connection diagnostics modal -->
    <div id="conn-modal" class="modal-backdrop" style="display:none">
        <div class="modal" style="max-width:420px">
            <header>
                <span>Ry≈°io diagnostika</span>
                <button id="conn-close">‚úï</button>
            </header>
            <div class="content">
                <div id="conn-body" class="log-area" style="white-space:pre-wrap"></div>
            </div>
        </div>
    </div>
</body>
</html>
